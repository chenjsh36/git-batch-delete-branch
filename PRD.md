# Git Batch Delete Branch - 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品名称
`git-batch-delete-branch` - Git 本地分支批量删除工具

### 1.2 产品定位
一个基于 Node.js 的命令行工具，帮助开发者快速、安全地批量删除 Git 项目的本地分支，提高开发效率。

### 1.3 目标用户
- 前端/后端开发者
- DevOps 工程师
- 需要频繁管理 Git 分支的团队

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 交互式批量选择删除
- **功能描述**: 用户通过终端交互界面选择要删除的分支
- **实现方式**: 
  - 显示所有本地分支列表（排除当前分支和主分支）
  - 支持多选操作（空格键选择/取消选择）
  - 支持全选/取消全选（a 键）
  - 支持确认删除操作
- **用户界面**: 类似 `git log --oneline` 的列表展示

#### 2.1.2 关键词过滤删除
- **功能描述**: 用户输入关键词，批量删除匹配的分支
- **实现方式**:
  - 支持精确匹配
  - 支持模糊匹配（包含关键词）
  - 支持前缀匹配
  - 支持后缀匹配
- **命令格式**: `git-batch-delete-branch --filter "keyword"`

#### 2.1.3 正则表达式过滤删除
- **功能描述**: 用户输入正则表达式，批量删除匹配的分支
- **实现方式**:
  - 支持完整的正则表达式语法
  - 提供正则表达式测试功能
  - 支持大小写敏感/不敏感选项
- **命令格式**: `git-batch-delete-branch --regex "pattern"`

### 2.2 安全功能

#### 2.2.1 保护机制
- 自动排除当前分支（防止误删）
- 自动排除主分支（main/master）
- 删除前显示预览列表
- 支持撤销操作（--dry-run 模式）

#### 2.2.2 确认机制
- 删除前要求用户确认
- 显示即将删除的分支数量
- 支持强制删除模式（--force）

### 2.3 辅助功能

#### 2.3.1 分支信息展示
- 显示分支创建时间
- 显示最后提交信息
- 显示分支是否已合并到主分支

#### 2.3.2 日志记录
- 记录删除操作日志
- 支持查看历史删除记录
- 支持导出删除日志

## 3. 技术需求

### 3.1 技术栈
- **语言**: TypeScript
- **运行时**: Node.js (>= 14.0.0)
- **包管理器**: npm
- **构建工具**: tsup 或 esbuild
- **测试框架**: Jest
- **命令行框架**: Commander.js 或 yargs

### 3.2 项目结构
```
git-batch-delete-branch/
├── src/
│   ├── index.ts              # 主入口文件
│   ├── cli.ts                # 命令行接口
│   ├── core/
│   │   ├── branch-manager.ts # 分支管理核心逻辑
│   │   ├── git-utils.ts      # Git 操作工具
│   │   └── filter.ts         # 过滤逻辑
│   ├── ui/
│   │   ├── interactive.ts    # 交互式界面
│   │   └── display.ts        # 显示格式化
│   └── utils/
│       ├── logger.ts         # 日志工具
│       └── validator.ts      # 验证工具
├── dist/                     # 编译输出目录
├── tests/                    # 测试文件
├── package.json
├── tsconfig.json
├── README.md
└── CHANGELOG.md
```

### 3.3 依赖管理
- **核心依赖**:
  - `commander`: 命令行参数解析
  - `inquirer`: 交互式命令行界面
  - `chalk`: 终端颜色输出
  - `ora`: 加载动画

- **开发依赖**:
  - `typescript`: TypeScript 编译器
  - `@types/node`: Node.js 类型定义
  - `jest`: 测试框架
  - `@types/jest`: Jest 类型定义
  - `tsup`: TypeScript 构建工具

## 4. 命令行接口设计

### 4.1 基本命令
```bash
# 交互式选择删除
git-batch-delete-branch

# 关键词过滤删除
git-batch-delete-branch --filter "feature"

# 正则表达式过滤删除
git-batch-delete-branch --regex "feature/.*"

# 预览模式（不实际删除）
git-batch-delete-branch --filter "feature" --dry-run

# 强制删除（跳过确认）
git-batch-delete-branch --filter "feature" --force
```

### 4.2 选项参数
- `--filter, -f`: 关键词过滤
- `--regex, -r`: 正则表达式过滤
- `--dry-run`: 预览模式
- `--force`: 强制删除
- `--exclude`: 排除分支模式
- `--include-merged`: 包含已合并分支
- `--verbose`: 详细输出
- `--help, -h`: 显示帮助信息
- `--version, -v`: 显示版本信息

## 5. 用户体验设计

### 5.1 交互流程
1. 用户执行命令
2. 系统检查 Git 仓库状态
3. 获取本地分支列表
4. 根据过滤条件筛选分支
5. 显示匹配的分支列表
6. 用户确认删除操作
7. 执行删除并显示结果

### 5.2 错误处理
- Git 仓库不存在或无效
- 网络连接问题
- 权限不足
- 分支删除失败
- 参数格式错误

### 5.3 输出格式
- 彩色输出区分不同类型信息
- 进度条显示删除进度
- 清晰的成功/失败状态提示
- 简洁的统计信息

## 6. 测试策略

### 6.1 单元测试
- 分支过滤逻辑测试
- Git 操作工具测试
- 参数验证测试
- 日志记录测试

### 6.2 集成测试
- 完整命令行流程测试
- 不同 Git 仓库状态测试
- 错误场景测试

### 6.3 端到端测试
- 真实 Git 仓库操作测试
- 用户交互流程测试

## 7. 发布计划

### 7.1 版本规划
- **v1.0.0**: 基础功能（交互式删除、关键词过滤）
- **v1.1.0**: 正则表达式过滤
- **v1.2.0**: 日志记录功能
- **v1.3.0**: 高级过滤选项

### 7.2 发布检查清单
- [ ] 代码审查完成
- [ ] 测试覆盖率 > 80%
- [ ] 文档完善
- [ ] 示例代码
- [ ] 变更日志更新
- [ ] npm 包发布

## 8. 维护计划

### 8.1 版本兼容性
- 支持 Node.js 14+ 版本
- 向后兼容主要功能
- 定期更新依赖包

### 8.2 社区支持
- GitHub Issues 跟踪
- 贡献指南
- 代码行为准则
- 定期维护更新
